<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Revlence — Customer Impact Discovery</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f8f9fc;
    --surface-1: #ffffff;
    --surface-2: #f2f4f8;
    --surface-3: #ebeef5;
    --border: #dde1ec;
    --border-accent: #b8c0d8;
    --text: #1a1d2e;
    --text-dim: #505775;
    --text-muted: #8890a8;

    --gate-amber: #d19a00;
    --gate-amber-bg: rgba(209, 154, 0, 0.07);
    --gate-amber-border: rgba(209, 154, 0, 0.22);

    --skip-red: #c62828;
    --skip-red-bg: rgba(198, 40, 40, 0.05);
    --skip-red-border: rgba(198, 40, 40, 0.18);

    --signal-blue: #015cde;
    --signal-blue-bg: rgba(1, 92, 222, 0.06);
    --signal-blue-border: rgba(1, 92, 222, 0.18);

    --stream-purple: #6a1b9a;
    --stream-purple-bg: rgba(106, 27, 154, 0.06);
    --stream-purple-border: rgba(106, 27, 154, 0.18);

    --churn-orange: #e65100;
    --churn-orange-bg: rgba(230, 81, 0, 0.06);
    --churn-orange-border: rgba(230, 81, 0, 0.18);

    --financial-green: #1b7d3a;
    --financial-green-bg: rgba(27, 125, 58, 0.06);
    --financial-green-border: rgba(27, 125, 58, 0.18);

    --issue-indigo: #015cde;
    --issue-indigo-bg: rgba(1, 92, 222, 0.06);
    --issue-indigo-border: rgba(1, 92, 222, 0.18);

    --output-brown: #4e342e;
    --output-brown-bg: rgba(78, 52, 46, 0.05);
    --output-brown-border: rgba(78, 52, 46, 0.15);

    --handoff-violet: #7341ff;
    --handoff-violet-bg: rgba(115, 65, 255, 0.08);
    --handoff-violet-border: rgba(115, 65, 255, 0.22);

    --enrich-teal: #00695c;
    --enrich-teal-bg: rgba(0, 105, 92, 0.06);
    --enrich-teal-border: rgba(0, 105, 92, 0.18);

    --voice-green: #1b7d3a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 48px 24px 64px;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background:
      radial-gradient(ellipse 600px 400px at 15% 8%, rgba(106, 27, 154, 0.025), transparent),
      radial-gradient(ellipse 500px 500px at 85% 92%, rgba(1, 92, 222, 0.025), transparent);
    pointer-events: none;
    z-index: 0;
  }

  .header {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
    z-index: 1;
  }

  .header-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--signal-blue);
    margin-bottom: 12px;
  }

  .header h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 32px;
    font-weight: 400;
    color: var(--text);
    letter-spacing: -0.3px;
  }

  .header p {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 8px;
  }

  .pipeline {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0;
    max-width: 820px;
    width: 100%;
    position: relative;
    z-index: 1;
  }

  /* Entry node */
  .entry-node {
    width: 100%;
    border: 2px solid var(--handoff-violet-border);
    border-radius: 14px;
    padding: 20px 32px;
    background: var(--handoff-violet-bg);
    text-align: center;
  }

  .entry-node .entry-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--handoff-violet);
    margin-bottom: 6px;
  }

  .entry-node .entry-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
  }

  .entry-node .entry-sub {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-dim);
    margin-top: 4px;
  }

  /* Phase cards */
  .phase-card {
    width: 100%;
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px 32px;
    position: relative;
    background: var(--surface-1);
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

  .phase-card:hover {
    border-color: var(--border-accent);
    box-shadow: 0 2px 20px rgba(0,0,0,0.04);
  }

  .phase-number {
    position: absolute;
    top: -11px;
    left: 28px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 2px 12px;
    border-radius: 10px;
    border: 1px solid;
  }

  .phase-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 15px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 3px;
    margin-top: 4px;
  }

  .phase-subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10.5px;
    color: var(--text-muted);
    margin-bottom: 20px;
  }

  .card-divider {
    height: 1px;
    background: var(--border);
    margin: 0 0 20px;
  }

  /* Phase colour themes */
  .phase-stream .phase-number { color: var(--stream-purple); background: var(--stream-purple-bg); border-color: var(--stream-purple-border); }
  .phase-signal .phase-number { color: var(--signal-blue); background: var(--signal-blue-bg); border-color: var(--signal-blue-border); }
  .phase-issue .phase-number  { color: var(--issue-indigo); background: var(--issue-indigo-bg); border-color: var(--issue-indigo-border); }
  .phase-output .phase-number { color: var(--output-brown); background: var(--output-brown-bg); border-color: var(--output-brown-border); }
  .phase-summary .phase-number { color: var(--enrich-teal); background: var(--enrich-teal-bg); border-color: var(--enrich-teal-border); }

  /* Flow steps */
  .flow-steps { display: flex; flex-direction: column; gap: 10px; }

  .flow-step {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    font-size: 13.5px;
    line-height: 1.55;
    color: var(--text-dim);
  }

  .flow-step strong { color: var(--text); }
  .flow-step code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11.5px;
    background: var(--surface-3);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 6px;
    color: var(--text);
  }

  .step-badge {
    flex-shrink: 0;
    font-family: 'JetBrains Mono', monospace;
    font-size: 9.5px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 3px 9px;
    border-radius: 6px;
    border: 1px solid;
    margin-top: 2px;
  }

  .step-badge.stream  { color: var(--stream-purple); background: var(--stream-purple-bg); border-color: var(--stream-purple-border); }
  .step-badge.signal  { color: var(--signal-blue);  background: var(--signal-blue-bg);   border-color: var(--signal-blue-border); }
  .step-badge.churn   { color: var(--churn-orange); background: var(--churn-orange-bg);  border-color: var(--churn-orange-border); }
  .step-badge.green   { color: var(--financial-green); background: var(--financial-green-bg); border-color: var(--financial-green-border); }
  .step-badge.issue   { color: var(--issue-indigo); background: var(--issue-indigo-bg);  border-color: var(--issue-indigo-border); }
  .step-badge.output  { color: var(--output-brown); background: var(--output-brown-bg);  border-color: var(--output-brown-border); }
  .step-badge.handoff { color: var(--handoff-violet); background: var(--handoff-violet-bg); border-color: var(--handoff-violet-border); }
  .step-badge.teal    { color: var(--enrich-teal); background: var(--enrich-teal-bg); border-color: var(--enrich-teal-border); }
  .step-badge.amber   { color: var(--gate-amber); background: var(--gate-amber-bg); border-color: var(--gate-amber-border); }

  /* Branch rows */
  .branch-row {
    display: flex;
    gap: 12px;
    margin: 12px 0;
    flex-wrap: wrap;
  }

  .branch-box {
    flex: 1;
    min-width: 180px;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    background: var(--surface-2);
  }

  .branch-label {
    font-family: 'Montserrat', sans-serif;
    font-size: 11.5px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 8px;
  }

  .branch-steps { display: flex; flex-direction: column; gap: 5px; }

  .branch-step {
    font-size: 12px;
    color: var(--text-dim);
    line-height: 1.5;
  }

  .branch-step code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10.5px;
    background: var(--surface-3);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 5px;
    color: var(--text);
  }

  /* Signal family grid */
  .signal-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin: 12px 0;
  }

  .signal-item {
    border: 1px solid var(--signal-blue-border);
    border-radius: 10px;
    padding: 12px 14px;
    background: var(--signal-blue-bg);
  }

  .signal-item.churn-item {
    border-color: var(--churn-orange-border);
    background: var(--churn-orange-bg);
  }

  .signal-item-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 11.5px;
    font-weight: 700;
    color: var(--signal-blue);
    margin-bottom: 4px;
  }

  .signal-item.churn-item .signal-item-title {
    color: var(--churn-orange);
  }

  .signal-item-desc {
    font-size: 11.5px;
    color: var(--text-dim);
    line-height: 1.45;
  }

  /* Issue Linking tiers */
  .tier-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin: 12px 0;
  }

  .tier-box {
    border: 1px solid var(--issue-indigo-border);
    border-radius: 10px;
    padding: 14px 16px;
    background: var(--issue-indigo-bg);
  }

  .tier-box.tier-3 {
    border-color: var(--gate-amber-border);
    background: var(--gate-amber-bg);
  }

  .tier-box.tier-4 {
    border-color: var(--border);
    background: var(--surface-2);
  }

  .tier-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--issue-indigo);
    margin-bottom: 6px;
  }

  .tier-box.tier-3 .tier-label { color: var(--gate-amber); }
  .tier-box.tier-4 .tier-label { color: var(--text-muted); }

  .tier-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 12px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 4px;
  }

  .tier-desc {
    font-size: 11.5px;
    color: var(--text-dim);
    line-height: 1.45;
  }

  .tier-desc code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10.5px;
    background: var(--surface-3);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 5px;
    color: var(--text);
  }

  /* Output tag grid */
  .output-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 8px;
    margin: 12px 0;
  }

  .output-item {
    border: 1px solid var(--output-brown-border);
    border-radius: 8px;
    padding: 10px 12px;
    background: var(--output-brown-bg);
  }

  .output-item-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 11px;
    font-weight: 700;
    color: var(--output-brown);
    margin-bottom: 3px;
  }

  .output-item-desc {
    font-size: 11px;
    color: var(--text-dim);
    line-height: 1.4;
  }

  /* Connectors */
  .connector {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    padding: 0;
    gap: 0;
  }

  .connector-stem {
    width: 2px;
    height: 18px;
    background: var(--border-accent);
  }

  .connector-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10.5px;
    color: var(--text-muted);
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 4px 14px;
    white-space: nowrap;
  }

  .connector-tag .arrow { margin-right: 4px; }

  /* Info callout */
  .callout {
    border-radius: 10px;
    padding: 12px 16px;
    margin: 12px 0 0;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    line-height: 1.6;
  }

  .callout.green {
    border: 1px solid var(--financial-green-border);
    background: var(--financial-green-bg);
    color: var(--financial-green);
  }

  .callout.amber {
    border: 1px solid var(--gate-amber-border);
    background: var(--gate-amber-bg);
    color: var(--gate-amber);
  }

  .callout.blue {
    border: 1px solid var(--signal-blue-border);
    background: var(--signal-blue-bg);
    color: var(--signal-blue);
  }

  .callout.churn {
    border: 1px solid var(--churn-orange-border);
    background: var(--churn-orange-bg);
    color: var(--churn-orange);
  }

  .section-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    padding-bottom: 8px;
    margin-bottom: 10px;
    border-bottom: 1px solid;
  }

  .section-label.blue { color: var(--signal-blue); border-color: var(--signal-blue-border); }
  .section-label.purple { color: var(--stream-purple); border-color: var(--stream-purple-border); }
  .section-label.green { color: var(--financial-green); border-color: var(--financial-green-border); }
  .section-label.churn { color: var(--churn-orange); border-color: var(--churn-orange-border); }
  .section-label.issue { color: var(--issue-indigo); border-color: var(--issue-indigo-border); }

  .version-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--text-muted);
    margin-top: 40px;
    letter-spacing: 1px;
    position: relative;
    z-index: 1;
  }
</style>
</head>
<body>

<div class="header">
  <div class="header-label">Revlence · Reasoning Layer</div>
  <h1>Customer Impact Discovery</h1>
  <p>customer-impact-discovery-spec · 20 Feb 2026</p>
</div>

<div class="pipeline">

  <!-- ═══════════════ ENTRY ═══════════════ -->
  <div class="entry-node">
    <div class="entry-label">Input</div>
    <div class="entry-title">EnrichedInteraction from Smart Ingestion</div>
    <div class="entry-sub">Transcript · metadata · customer profile · stream context (resolved or deferred) · open issues</div>
  </div>

  <div class="connector">
    <div class="connector-stem"></div>
    <div class="connector-tag"><span class="arrow">↓</span> Begin processing</div>
    <div class="connector-stem"></div>
  </div>

  <!-- ═══════════════ PHASE 1: STREAM & PROMOTION ═══════════════ -->
  <div class="phase-card phase-stream">
    <div class="phase-number">Phase 1</div>
    <div class="phase-title">Stream & Promotion Resolution</div>
    <div class="phase-subtitle">stream confirmation or inference → promotion resolution → sltv computation</div>
    <div class="card-divider"></div>

    <div class="flow-steps">
      <div class="flow-step">
        <span class="step-badge stream">Resolve</span>
        <span class="step-content"><strong>Stream Attribution</strong> — if Smart Ingestion resolved the stream (Tiers 1–2), carry it forward. If not, run inferential resolution:</span>
      </div>
    </div>

    <div style="border: 1px solid var(--stream-purple-border); border-radius: 10px; padding: 18px 20px; background: var(--stream-purple-bg); margin: 12px 0 16px;">
      <div class="section-label purple">Customer Impact Discovery — Inferential Resolution</div>
      <div class="branch-row" style="margin: 0;">
        <div class="branch-box" style="border-color: var(--stream-purple-border); background: rgba(106,27,154,0.04);">
          <div class="branch-label" style="color: var(--stream-purple);">Tier 3: LLM Inference</div>
          <div class="branch-steps">
            <div class="branch-step">No metadata, no rules — LLM reads transcript to infer stream from conversation context</div>
            <div class="branch-step" style="color: var(--text-muted);">Single clean match → confidence gate → assign. Ambiguous → fall to Tier 4.</div>
          </div>
        </div>
        <div class="branch-box" style="border-color: var(--stream-purple-border); background: rgba(106,27,154,0.04);">
          <div class="branch-label" style="color: var(--stream-purple);">Tier 4: Linked Streams</div>
          <div class="branch-steps">
            <div class="branch-step">Fuzzy resolution using open issues and repeat contact history within <code>context_window</code> against customer profile linked streams</div>
            <div class="branch-step" style="color: var(--text-muted);">Unresolved → <code>stream_id = null</code>, <code>ambiguity_flag = TRUE</code>, excluded from stream-scoped scoring</div>
          </div>
        </div>
      </div>
    </div>

    <div class="flow-steps">
      <div class="flow-step">
        <span class="step-badge stream">Resolve</span>
        <span class="step-content"><strong>Promotion Resolution</strong> — if Promotions module enabled, check metadata (Tier 1), customer profile (Tier 2), fuzzy match (Tier 3). Load stream config and <code>promotion_financial_subtraction</code> where configured.</span>
      </div>
      <div class="flow-step">
        <span class="step-badge green">Compute</span>
        <span class="step-content"><strong>SLTV Resolution</strong> — resolve <code>resolved_sltv</code> from customer metadata, variant, or stream mode (direct / stream average / computed A×B×C). <code>resolved_sltv</code> always stored regardless of path. Promotion financial subtraction applied where configured.</span>
      </div>
    </div>

    <div class="callout green" style="margin-top: 14px;">
      ✓ Stream and promotion context is now locked. All downstream signal families operate within this resolved stream context. Taxonomy selection, context window, and scoring scope follow from here.
    </div>
  </div>

  <div class="connector">
    <div class="connector-stem"></div>
    <div class="connector-tag"><span class="arrow">↓</span> Stream context locked · resolved_sltv stored</div>
    <div class="connector-stem"></div>
  </div>

  <!-- ═══════════════ PHASE 2: TRANSCRIPT SUMMARISATION ═══════════════ -->
  <div class="phase-card phase-summary">
    <div class="phase-number">Phase 2</div>
    <div class="phase-title">Transcript Summarisation</div>
    <div class="phase-subtitle">interaction_summary generation → single unstructured input for all downstream steps</div>
    <div class="card-divider"></div>

    <div class="flow-steps">
      <div class="flow-step">
        <span class="step-badge teal">Summarise</span>
        <span class="step-content"><strong>Generate <code>interaction_summary</code></strong> — distil the full transcript into a structured narrative summary. Captures intent, friction, sentiment arc, agent response, and outcome context in a form that is cheaper and more consistent to process than raw transcript.</span>
      </div>
      <div class="flow-step">
        <span class="step-badge teal">Store</span>
        <span class="step-content"><strong>Store summary as the single unstructured input</strong> — used by signal families for detection context and by Issue Linking's LLM tiebreaker (Tier 3) where required. Raw transcript is not passed downstream.</span>
      </div>
    </div>

    <div class="callout blue" style="margin-top: 14px;">
      The interaction_summary is the boundary between raw transcript and structured processing. Everything downstream operates on structured signals or this summary — never the raw transcript directly.
    </div>
  </div>

  <div class="connector">
    <div class="connector-stem"></div>
    <div class="connector-tag"><span class="arrow">↓</span> interaction_summary stored</div>
    <div class="connector-stem"></div>
  </div>

  <!-- ═══════════════ PHASE 3: SIGNAL FAMILY DETECTION ═══════════════ -->
  <div class="phase-card phase-signal">
    <div class="phase-number">Phase 3</div>
    <div class="phase-title">Signal Family Detection & Classification</div>
    <div class="phase-subtitle">eight families · each produces structured findings independently</div>
    <div class="card-divider"></div>

    <div class="flow-steps" style="margin-bottom: 16px;">
      <div class="flow-step">
        <span class="step-badge signal">Detect</span>
        <span class="step-content">Each signal family runs against the transcript and <code>interaction_summary</code>. For each: detect presence → extract plain-language reason → classify to subcategory and category → assign confidence score → extract tags. <strong>Subcategory is the anchor — category is always derived from subcategory, never the reverse.</strong> Families without a detected signal are skipped cleanly.</span>
      </div>
    </div>

    <div style="border: 1px solid var(--signal-blue-border); border-radius: 10px; padding: 18px 20px; background: var(--signal-blue-bg); margin-bottom: 14px;">
      <div class="section-label blue">Experience & Operations Signal Families</div>
      <div class="signal-grid">
        <div class="signal-item">
          <div class="signal-item-title">Contact Driver</div>
          <div class="signal-item-desc">Primary and additional subcategory. Stream-specific taxonomy. Anchor for Issue Linking.</div>
        </div>
        <div class="signal-item">
          <div class="signal-item-title">Dissatisfaction Driver</div>
          <div class="signal-item-desc">Flag, severity, subcategory. Confidence amplifier for Issue Linking — not an anchor. Stream-specific taxonomy.</div>
        </div>
        <div class="signal-item">
          <div class="signal-item-title">Repeat Contact Driver</div>
          <div class="signal-item-desc">Links to prior interaction within window. Assigns <code>driver_key</code> and <code>repeat_window_days</code>. Stream-specific taxonomy.</div>
        </div>
        <div class="signal-item">
          <div class="signal-item-title">Contact Resolution Driver</div>
          <div class="signal-item-desc">Was this contact resolved? Resolution type classification. Revlence default taxonomy.</div>
        </div>
        <div class="signal-item">
          <div class="signal-item-title">Issue Resolution Driver</div>
          <div class="signal-item-desc">Was the underlying issue resolved? Resolution outcome. Revlence default taxonomy.</div>
        </div>
        <div class="signal-item">
          <div class="signal-item-title">Urgency Driver</div>
          <div class="signal-item-desc">Urgency flag and rating (0–1). Revlence default taxonomy — not client-customised.</div>
        </div>
        <div class="signal-item" style="grid-column: 1 / -1;">
          <div class="signal-item-title">Escalation Driver</div>
          <div class="signal-item-desc">Escalation flag and type — Supervisor / Complaints / Legal. Revlence default taxonomy. Severity gradient drives downstream risk amplification.</div>
        </div>
      </div>
    </div>

    <div style="border: 1px solid var(--churn-orange-border); border-radius: 10px; padding: 18px 20px; background: var(--churn-orange-bg);">
      <div class="section-label churn">Churn Signal Family — Dedicated Logic</div>
      <div class="signal-grid" style="grid-template-columns: 1fr 1fr 1fr;">
        <div class="signal-item churn-item">
          <div class="signal-item-title">Churn Request</div>
          <div class="signal-item-desc">Always assessed. Intent to leave. Org-level taxonomy. Triggers churn save and outcome classification.</div>
        </div>
        <div class="signal-item churn-item">
          <div class="signal-item-title">Churn Save</div>
          <div class="signal-item-desc">Only when <code>churn_request = TRUE</code>. Save attempt method and customer response: accepted / partially received / rejected / ignored.</div>
        </div>
        <div class="signal-item churn-item">
          <div class="signal-item-title">Churn Outcome</div>
          <div class="signal-item-desc">11-status taxonomy via strict 6-step decision tree. Only when <code>churn_request = TRUE</code>. See Churn Classification spec.</div>
        </div>
      </div>
      <div class="callout churn" style="margin-top: 12px; background: rgba(230,81,0,0.04); border-color: var(--churn-orange-border);">
        Anomalous paths flagged: retained with no save attempt · disengaged after save · unresolved with or without save. All flagged for review.
      </div>
    </div>
  </div>

  <div class="connector">
    <div class="connector-stem"></div>
    <div class="connector-tag"><span class="arrow">↓</span> Contact Driver and Dissatisfaction Driver complete → Issue Linking can begin</div>
    <div class="connector-stem"></div>
  </div>

  <!-- ═══════════════ PHASE 4: ISSUE LINKING ═══════════════ -->
  <div class="phase-card phase-issue">
    <div class="phase-number">Phase 4</div>
    <div class="phase-title">Issue Linking</div>
    <div class="phase-subtitle">context window pre-filter → 4-tier matching → churn issue linking</div>
    <div class="card-divider"></div>

    <div class="flow-steps" style="margin-bottom: 16px;">
      <div class="flow-step">
        <span class="step-badge amber">Pre-filter</span>
        <span class="step-content"><strong>Context Window Pre-filter</strong> — exclude open issues whose <code>last_interaction_at</code> falls outside the stream-level <code>context_window</code>. Hard exclusion — not a confidence modifier. Issues outside the window are not candidates.</span>
      </div>
    </div>

    <div style="border: 1px solid var(--issue-indigo-border); border-radius: 10px; padding: 18px 20px; background: var(--issue-indigo-bg); margin-bottom: 14px;">
      <div class="section-label issue">Matching Tiers — Contact Driver is the Anchor</div>
      <div class="tier-grid">
        <div class="tier-box">
          <div class="tier-label">Tier 1</div>
          <div class="tier-title">Subcategory Match</div>
          <div class="tier-desc"><code>contact_subcategory</code> matches open issue subcategory. Auto-link. Confidence: <strong>high</strong>. No LLM. If additional subcategory matches a different issue → escalate to Tier 3.</div>
        </div>
        <div class="tier-box">
          <div class="tier-label">Tier 2</div>
          <div class="tier-title">Category Match</div>
          <div class="tier-desc"><code>contact_category</code> matches open issue category. Subcategory drift is normal issue evolution. Auto-link. Confidence: <strong>moderate</strong>. No LLM.</div>
        </div>
        <div class="tier-box tier-3">
          <div class="tier-label">Tier 3</div>
          <div class="tier-title">LLM Tiebreaker</div>
          <div class="tier-desc">Multi-topic contact where additional subcategory pulls toward a different issue. LLM reads <code>interaction_summary</code> only. If unresolved → Tier 4.</div>
        </div>
        <div class="tier-box tier-4">
          <div class="tier-label">Tier 4</div>
          <div class="tier-title">New Issue</div>
          <div class="tier-desc">No match at subcategory or category level, or all candidates excluded, or LLM cannot resolve. Create new Issue Object.</div>
        </div>
      </div>
      <div style="margin-top: 12px; font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text-muted);">
        Dissatisfaction signals amplify confidence when they align with the contact match. They do not drive the match — contact is the anchor. Misalignment is expected and does not trigger ambiguity.
      </div>
    </div>

    <div style="border: 1px solid var(--churn-orange-border); border-radius: 10px; padding: 16px 20px; background: var(--churn-orange-bg);">
      <div class="section-label churn">Churn Issue Linking</div>
      <div class="branch-row" style="margin: 0; gap: 10px;">
        <div class="branch-box" style="border-color: var(--churn-orange-border); background: rgba(230,81,0,0.04);">
          <div class="branch-label" style="color: var(--churn-orange);">Service issue + churn</div>
          <div class="branch-steps">
            <div class="branch-step">Service issue linked via standard contact-anchored matching. Churn issue links to service issue via <code>related_issue_id</code> only when content signals support causal relationship.</div>
          </div>
        </div>
        <div class="branch-box" style="border-color: var(--churn-orange-border); background: rgba(230,81,0,0.04);">
          <div class="branch-label" style="color: var(--churn-orange);">Churn only — no service issue</div>
          <div class="branch-steps">
            <div class="branch-step">Churn issue stands alone. <code>related_issue_id = null</code>. No causal link forced where content signals do not support one.</div>
          </div>
        </div>
      </div>
      <div style="margin-top: 10px; font-family: 'JetBrains Mono', monospace; font-size: 10.5px; color: var(--churn-orange);">
        ⚑ Churn linking waits for service issue resolution — related_issue_id cannot be set until issue_id is confirmed.
      </div>
    </div>

    <div class="callout blue" style="margin-top: 14px;">
      Outputs: <code>issue_id</code> · <code>issue_match_confidence</code> (high / moderate / llm_resolved / new_issue) · <code>issue_match_source</code> · <code>related_issue_id</code> (nullable) · <code>secondary_issue_subcategory</code> (noted, not scored in v1)
    </div>
  </div>

  <div class="connector">
    <div class="connector-stem"></div>
    <div class="connector-tag"><span class="arrow">↓</span> All signal objects compiled</div>
    <div class="connector-stem"></div>
  </div>

  <!-- ═══════════════ PHASE 5: PACKAGING & HANDOFF ═══════════════ -->
  <div class="phase-card phase-output">
    <div class="phase-number">Phase 5</div>
    <div class="phase-title">Packaging & Handoff</div>
    <div class="phase-subtitle">compile signal objects → append to EnrichedInteraction → route downstream</div>
    <div class="card-divider"></div>

    <div class="flow-steps" style="margin-bottom: 16px;">
      <div class="flow-step">
        <span class="step-badge output">Compile</span>
        <span class="step-content"><strong>Assemble all Customer Impact Signal Objects</strong> — stream context, signal family findings, issue link, and churn outputs combined into a single structured package. No scoring or financial computation occurs here.</span>
      </div>
    </div>

    <div class="output-grid">
      <div class="output-item">
        <div class="output-item-title">Stream Context</div>
        <div class="output-item-desc">stream_id · assignment_source · resolved_sltv · promotion_id</div>
      </div>
      <div class="output-item">
        <div class="output-item-title">Contact Driver</div>
        <div class="output-item-desc">Flag · reason · subcategory · category · confidence · tags</div>
      </div>
      <div class="output-item">
        <div class="output-item-title">Dissatisfaction Driver</div>
        <div class="output-item-desc">Flag · reason · subcategory · severity · confidence</div>
      </div>
      <div class="output-item">
        <div class="output-item-title">Repeat Contact Driver</div>
        <div class="output-item-desc">Flag · prior interaction link · driver_key · repeat_window_days</div>
      </div>
      <div class="output-item">
        <div class="output-item-title">Churn</div>
        <div class="output-item-desc">Request · save attempt + response · outcome (11-status) · outcome signals</div>
      </div>
      <div class="output-item">
        <div class="output-item-title">Resolution Drivers</div>
        <div class="output-item-desc">Contact resolution type · issue resolution outcome</div>
      </div>
      <div class="output-item">
        <div class="output-item-title">Urgency & Escalation</div>
        <div class="output-item-desc">Urgency rating · escalation type and severity gradient</div>
      </div>
      <div class="output-item">
        <div class="output-item-title">Issue Link</div>
        <div class="output-item-desc">issue_id · match confidence · match source · related_issue_id</div>
      </div>
      <div class="output-item">
        <div class="output-item-title">Interaction Summary</div>
        <div class="output-item-desc">interaction_summary · churn_request_reason_snippet</div>
      </div>
    </div>

    <div class="flow-steps" style="margin-top: 14px;">
      <div class="flow-step">
        <span class="step-badge output">Append</span>
        <span class="step-content">Append Customer Impact Signal Objects to <strong>EnrichedInteraction</strong>.</span>
      </div>
      <div class="flow-step">
        <span class="step-badge handoff">Handoff</span>
        <span class="step-content"><strong>Route to downstream scoring and attribution</strong> — Impact Scoring and Financial Attribution receive the complete structured package. Customer Impact Discovery does not score, attribute, or compute financial values.</span>
      </div>
    </div>
  </div>

</div>

<div class="version-tag">customer-impact-discovery-spec · 20 Feb 2026</div>

</body>
</html>
